cmake_minimum_required(VERSION 3.31)
project(sadhana)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Find required packages
find_package(PkgConfig REQUIRED)
pkg_check_modules(PORTAUDIO REQUIRED portaudio-2.0)
pkg_check_modules(SQLITE3 REQUIRED sqlite3)

# Optional: Check for JACK support
pkg_check_modules(JACK jack)
if(JACK_FOUND)
    add_definitions(-DHAVE_JACK)
endif()

# Add Vosk dependency (you'll need to provide the path to Vosk library)
set(VOSK_ROOT "" CACHE PATH "Path to Vosk library")
if(NOT VOSK_ROOT)
    message(FATAL_ERROR "Please specify VOSK_ROOT path")
endif()

include_directories(
    ${PORTAUDIO_INCLUDE_DIRS}
    ${SQLITE3_INCLUDE_DIRS}
    ${VOSK_ROOT}/include
    include
)

# Add source files
add_executable(sadhana
    src/main.cpp
    src/audio/audio_capture.cpp
    src/audio/vad.cpp
    src/asr/vosk_recognizer.cpp
    src/db/database.cpp
    src/config/config.cpp
    src/ritual/phrase_matcher.cpp
)

target_link_libraries(sadhana
    ${PORTAUDIO_LIBRARIES}
    ${SQLITE3_LIBRARIES}
    ${VOSK_ROOT}/lib/libvosk.so
    -ldl
    -lpthread
)